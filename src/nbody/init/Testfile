DIR = src/nbody/init
BIN = snapenter mkplummer mkexpdisk real mkommod mkhomsph mkspiral
NEED = $(BIN) tsf snapprint

help:
	@echo $(DIR)

need:
	@echo $(NEED)

clean:
	@echo Cleaning $(DIR)
	@rm -f snapenter.in snapenter.out snapenter.cmp mkplummer.out mkexpdisk.out
	@rm -f mkhomsph.out mkommod.out

NBODY = 10

all: $(BIN)

snapenter:
	@echo Creating snapenter.in
	@echo "snapenter.out" > snapenter.in
	@echo "2" >> snapenter.in
	@echo "1.0" >> snapenter.in
	@echo "-1" >> snapenter.in
	@echo "0" >> snapenter.in
	@echo "0" >> snapenter.in
	@echo "0" >> snapenter.in
	@echo "-0.125" >> snapenter.in
	@echo "0" >> snapenter.in
	@echo "0.5" >> snapenter.in
	@echo "2" >> snapenter.in
	@echo "0" >> snapenter.in
	@echo "0" >> snapenter.in
	@echo "0" >> snapenter.in
	@echo "0.25" >> snapenter.in
	@echo "0" >> snapenter.in
	snapenter < snapenter.in verbose=f headline="test suite"  ; nemo.coverage snapenter.c
	@echo Running tsf
	tsf snapenter.out
	@echo Running snapprint
	snapprint snapenter.out m,x,y,z,vx,vy,vz
	@echo Comparing snapenter.out snapenter.cmp
	tsf snapenter.out octal=t | rsf - snapenter.cmp ; cmp snapenter.cmp snapenter.out

mkplummer:
	@echo Running $@
	mkplummer mkplummer.out $(NBODY) seed=123 ; nemo.coverage mkplummer.c
	tsf mkplummer.out
	mkplummer - $(NBODY) seed=123 |\
		massname="n(m)" masspars=p,-2 massrange=0.5,10 |\
		tsf - ;  nemo.coverage mkplummer.c

mkexpdisk:
	@echo Running $@
	mkexpdisk mkexpdisk.out $(NBODY) seed=123 ; nemo.coverage mkexpdisk.c
	tsf mkexpdisk.out

mkommod:
	@echo Running $@
	mkommod $(NEMODAT)/k5isot.dat mkommod.out $(NBODY) seed=123
	tsf mkommod.out

mkhomsph:
	@echo Running $@
	mkhomsph mkhomsph.out $(NBODY) seed=123
	tsf mkhomsph.out

mkspiral:
	@echo Running $@
	mkspiral mkspiral.out $(NBODY) seed=123 a=100
	tsf mkspiral.out

real:
	@echo f2d conversion:
	mkplummer - 100 | csf - - convert=f2d | snapplot - 
	@echo d2f conversion:
	mkplummer - 100 | csf - - convert=d2f | snapplot - 

