<!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>CCDZSHIFT(1NEMO) manual page</title>
</head>
<body bgcolor='white'>
<a href='#toc'>Table of Contents</a><p>

<h2><a name='sect0' href='#toc0'>Name</a></h2>
ccdzshift- re-align spectra from a cube based on a reference Z map 
<h2><a name='sect1' href='#toc1'>Synopsis</a></h2>
<b>ccdzshift</b>
[parameter=value] 
<h2><a name='sect2' href='#toc2'>Description</a></h2>
<b>ccdzshift</b> re-align all spectra in a cube based
on a reference map of where a reference Z value (<i>velicity</i>) centroid should
be. The shift is towards the center of the cube. <p>
The current version is optimized
for galaxy cubes, where everything is velocity based, and searching for
low density gas in the outer regions. Another application is high-Z frequency
based, and stack based on certain spectral lines and look for a signal.

<h2><a name='sect3' href='#toc3'>Parameters</a></h2>
The following parameters are recognized in any order if the keyword
is also given: 
<dl>

<dt><b>in=</b> </dt>
<dd>Input image cube. No default. </dd>

<dt><b>map=</b> </dt>
<dd>Z reference map. The
values </dd>

<dt><b>out=</b> </dt>
<dd>Re-aligned output cube. No default. </dd>

<dt><b>wcs=0|1|2</b> </dt>
<dd>0=use 0-based pixel
1=use 1-based pixel 2=use WCS </dd>

<dt><b>nearest=t|f</b> </dt>
<dd>Shift spectra using nearest pixel,
or interpolate? [t] </dd>

<dt><b>center=</b> </dt>
<dd>If given, this pixel will be the reference
centroid of the cube. Although this gives the option to crop a large cube
to a smaller one to contain the final signal, it will corrupt the WCS. </dd>
</dl>

<h2><a name='sect4' href='#toc4'>Examples</a></h2>
Following
along the example in <a href='ccdvel.1.html'><i>ccdvel(1NEMO)</i></a>
 we have make an example with a falling
density in the outer parts to see how much can be recovered using stacking
(shifting) and integrating in elliptical rings. Some noise is added to ensure
the outer regions to ensure the line is buried in the noise, unless the
signal is stacked/integrated in rings: <br>
<pre>  # make lookup tables
  nemoinp 0:140:5 &gt; map1.radt
  tabmath map1.radt map1.dent  "exp(-%1/20)" all
  tabmath map1.radt map1.velt  "%1/sqrt(40+%1*%1)" all
  # velocity and density
  ccdvel out=map1.vel radii=@map1.radt vrot=@map1.velt pa=45 inc=60 size=256
vsys=10
  ccdvel out=map1.den radii=@map1.radt vrot=@map1.dent pa=45 inc=60 size=256
amp=t
  # cube with and without noise
  velcube invel=map1.vel inden=map1.den out=map1.cube sigdefault=0.1 zrange=8:12
nz=200 
  velcube invel=map1.vel inden=map1.den out=- sigdefault=0.1 zrange=8:12 nz=200
| ccdmath - map1n.cube &rsquo;%1+rang(0,0.001)&rsquo;
  # shifted cubes (adding noise back where it was lost due to the shift)
  ccdzshift map1.cube  map1.vel  map2.cube
  ccdzshift map1n.cube map1.vel  - |  ccdmath - map2n.cube &rsquo;ifeq(%1,0,%1+rang(0,0.001),%1)&rsquo;
  ccdellint map2.cube  0:200:2 pa=45 inc=60 vsys=10 center=128,128 out=map2.rv
  ccdellint map2n.cube 0:200:2 pa=45 inc=60 vsys=10 center=128,128 out=map2n.rv
  ccdellint map2n.cube 0:200:2 pa=45 inc=60 vsys=10 center=128,128 out=map2m.rv
norm=f
  ccdmom map2n.rv - axis=2 mom=0 | ccdprint - x= newline=t label=x  | tabmath
- - &rsquo;%1,log(%2)&rsquo; all | tabplot - 1 2 color=2 point=2,0.1 line=1,1 xcoord=140
  ccdmom map2n.rv - axis=2 mom=1 | ccdprint - x= newline=t label=x  | tabplot
- 1 2 color=2 point=2,0.1 line=1,1 ymin=9 ymax=11 xcoord=140
  ccdmom map2n.rv - axis=2 mom=2 | ccdprint - x= newline=t label=x  | tabplot
- 1 2 color=2 point=2,0.1 line=1,1 ymin=0 ymax=2  xcoord=140
  # this mom=2 plot has lots of NaN&rsquo;s at radii
</pre>A more realistic example would be to use observational data: <br>
<pre>  # this is a 371 x 251 x 89 VLA cube
  fitsccd ngc6503_vrad.fits ngc6503.ccd
  #   xpos,ypos is 0 based
  vsys=28
  xpos=162.5
  ypos=122.2
  inc=75
  pa=-65
  radii=0,0.0005,0.001,0.002,0.003,0.004,0.006,0.01,0.02,0.25,100
  vrot=0,22,43,72,88,98,106,112,114,115,115
  tabmath ngc6503/ngc6503.rotmod - %1/3600.0 all &gt; junk.radt
  tabmath ngc6503/ngc6503.rotmod - %2 all        &gt; junk.velt
  
  ccdvel in=ngc6503vel.ccd out=junk radii=@junk.radt vrot=@junk.velt inc=75
pa=-65 center=163,123 vsys=28
  ccdvel in=ngc6503vel.ccd out=junk radii=$radii vrot=$vrot inc=75 pa=-65
center=163,123 vsys=28
  ccdzshift ngc6503.ccd ngc6503vel.ccd
  # cheating
  ccdfill ngc6503vel.ccd junkvel10.ccd n=10
  ccdzshift ngc6503.ccd junkvel10.ccd  junk10
  ccd
  ccdellint junk10 0:0.3:0.0015 pa=$pa inc=$inc vsys=$vsys center=$xpos,$ypos
out=junk10.rv
  ccdmom junk10.rv - axis=2 mom=2 | ccdprint - x= newline=t label=x | tabmath
- - &rsquo;%1*3600,%2&rsquo; all 
ccdmom junk10.rv - axis=2 mom=0 | ccdprint - x= newline=t label=x  | tabmath
- - &rsquo;%1*3600,%2&rsquo; all | tabplot - 1 2 0 1200 0 0.008 color=2 point=2,0.1 line=1,1
ccdmom junk10.rv - axis=2 mom=1 | ccdprint - x= newline=t label=x  | tabmath
- - &rsquo;%1*3600,%2&rsquo; all | tabplot - 1 2 0 1200 -160 160  color=2 point=2,0.1 line=1,1
ycoord=0
ccdmom junk10.rv - axis=2 mom=2 | ccdprint - x= newline=t label=x  | grep -v
nan | tabmath - - &rsquo;%1*3600,%2&rsquo; all | tabplot - 1 2 0 1200 -160 160  color=2 point=2,0.1
line=1,1 ycoord=0
ccdellint junk10 0:0.3:0.002 pa=$pa inc=$inc vsys=$vsys center=$xpos,$ypos
out=junk12.rv
ccdsub junk10 junk11 z=25:65
ccdellint junk11 0:0.3:0.0015 pa=$pa inc=$inc vsys=$vsys center=$xpos,$ypos
out=junk11.rv
ccdfill ngc6503vel.ccd junkvel20.ccd n=20
ccdzshift ngc6503.ccd junkvel20.ccd  junk20
ccdellint junk20 0:0.3:0.0015 pa=$pa inc=$inc vsys=$vsys center=$xpos,$ypos
out=junk20.rv
ccdvel in=ngc6503vel.ccd out=junkvel30.ccd radii=$radii vrot=$vrot inc=$inc
pa=$pa center=$xpos,$ypos vsys=$vsys
ccdzshift ngc6503.ccd junkvel30.ccd  junk30
ccdellint junk30 0:0.3:0.0015 pa=$pa inc=$inc vsys=$vsys center=$xpos,$ypos
out=junk30.rv
ccdellint junk30 0:0.3:0.0015 pa=$pa inc=$inc vsys=$vsys center=$xpos,$ypos
out=junk30n.rv norm=f
ccdmom junk30.rv - axis=2 mom=0 | ccdprint - x= newline=t label=x  | tabmath
- - &rsquo;%1*3600,%2&rsquo; all | tabplot - 1 2 0 1200 0 0.008 color=2 point=2,0.1 line=1,1
</pre>
<h2><a name='sect5' href='#toc5'>See Also</a></h2>
<a href='nemoinp.1.html'>nemoinp(1NEMO)</a>
, <a href='tabmath.1.html'>tabmath(1NEMO)</a>
, <a href='ccdvel.1.html'>ccdvel(1NEMO)</a>
, <a href='ccdmath.1.html'>ccdmath(1NEMO)</a>
,
<a href='velcube.1.html'>velcube(1NEMO)</a>
, <a href='image.5.html'>image(5NEMO)</a>
 
<h2><a name='sect6' href='#toc6'>Files</a></h2>
NEMO/src/image/trans/ccdzshift.c 
<h2><a name='sect7' href='#toc7'>Author</a></h2>
Peter
Teuben 
<h2><a name='sect8' href='#toc8'>Update History</a></h2>
<br>
<pre>30-Nov-20<tt> </tt>&nbsp;<tt> </tt>&nbsp;V0.1 drafted w/ example<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
</pre><p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<li><a name='toc3' href='#sect3'>Parameters</a></li>
<li><a name='toc4' href='#sect4'>Examples</a></li>
<li><a name='toc5' href='#sect5'>See Also</a></li>
<li><a name='toc6' href='#sect6'>Files</a></li>
<li><a name='toc7' href='#sect7'>Author</a></li>
<li><a name='toc8' href='#sect8'>Update History</a></li>
</ul>
</body>
</html>
