<!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>RVSTACK(1NEMO) manual page</title>
</head>
<body bgcolor='white'>
<a href='#toc'>Table of Contents</a><p>

<p> 
<h2><a name='sect0' href='#toc0'>Name</a></h2>
rvstack - extract Radius-Velocity diagram from a data cube for later

<p>stacking 
<p> 
<h2><a name='sect1' href='#toc1'>Synopsis</a></h2>
<b>rvstack</b> in=cube out=map [parameter=value] 
<p> 
<h2><a name='sect2' href='#toc2'>Description</a></h2>
<b>rvstack</b>
takes all points within a (narrow) wedge around the major or minor axis
of an assumed galaxy disk data cube, and stacks these data to construct
a Radius-Velocity diagram, centered on the galaxy in position and velocity.
It will also stack the two sides of the galaxy (see also <b>side=</b>), so the
radial coordinate will run from 0 to some Rmax. In velocity it will run
from some -Vmax to Vmax, but always expecting positive rotation around the
Z axis, and positive outflow along the Z axis, assuming the position angle
of the galactic disk is correctly set.  <p>
Weak signal rotation and/or bulk
outflow could be detected this way, but we offer no guarentee. If you have
many like-minded galaxies, stacking these images may beat the noise down
much more. <p>
Options exist to scale the Radius and Velocity to different units,
such that many galaxies can be stacked in physical space, as opposed to
observed space. See <b>rscale=</b> and <b>vscale=</b>. <p>
See also <a href='ccdstack.1.html'><i>ccdstack(1NEMO)</i></a>
 for the
final stacking operation. <p>
When <b>gscale=t</b> is set, the coordinates are scaled
as follows: <br>
<pre>Rotation<tt> </tt>&nbsp;<tt> </tt>&nbsp;Outflow
--------<tt> </tt>&nbsp;<tt> </tt>&nbsp;---------
R<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;<tt> </tt>&nbsp;R/cos(i)
V/sin(i)<tt> </tt>&nbsp;<tt> </tt>&nbsp;V/cos(i)
</pre>this will likely leave some gaps in radius and velocity. See CAVEATS below.
<p>
You can also select to only construct the signal from one side of the galaxy.
See <b>side=</b> below. <p>
Points along an arc are all accumulated (technically: averaged),
and placed on the same radial grid as the pixel size in the input data
cube. We might need some trick next neighbor smoothing in order for pixels
near the center to have a value. 
<p> 
<h2><a name='sect3' href='#toc3'>Parameters</a></h2>
 The following parameters are
recognized in order; they may be given in any order if the keyword is also
given. Use --help to confirm this man page is up to date.  
<dl>

<dt><b>in=</b><i>image_cube</i> </dt>
<dd>input
data cube, in standard <a href='image.5.html'><i>image(5NEMO)</i></a>
 format. [No default] </dd>

<dt><b>out=</b><i>image_map</i> </dt>
<dd>output
R-V map. [No default] </dd>

<dt><b>pa=</b> </dt>
<dd>position angle along which the wedge is taken. This
is normally  the <b>major axis receding side</b> (with mode=rotation) or the <b>minor
axis far side</b> (for mode=outflow), in order get a positive velocity signal
in the RV map. Only when <b>gscale=t</b> is set, will there be a difference how
the radius and velocity are scaled. </dd>

<dt><b>inc=</b> </dt>
<dd>inclination angle of the disk [45]
</dd>

<dt><b>vsys=</b> </dt>
<dd>systemic velocity [0]    </dd>

<dt><b>center=</b><i>xpos,ypos</i> </dt>
<dd>rotation center (0,0=lower
left). If not supplied, the reference pixel will be used. Default: reference
pixel. </dd>

<dt><b>angle=</b> </dt>
<dd>angle around major or minor axis around which points are accumulated
into the R-V plot. For high inclination galaxies rotation would argue for
a smaller angle, while outflow can deal with larger angles. And vice versa
for low inclination galaxies.  [Default: 10] </dd>

<dt><b>blank=</b> </dt>
<dd>Value of the blank pixel
to be ignored. Not yet used. </dd>

<dt><b>rscale=</b> </dt>
<dd>Scaling factor for radius. This would
be used to stack galaxies based on a physical kpc scaling, or an <b>Re</b> scaling,
not geometry, see <b>gscale=</b> below.  [Default: 1] </dd>

<dt><b>vscale=</b> </dt>
<dd>Scaling factor for
velocity. This would be  used to stack galaxies based on a mass scaling,
not geometry, see <b>gscale=</b> below. [Default: 1] </dd>

<dt><b>gscale=f|t</b> </dt>
<dd>A boolean if to
scale for (inclination and position angle based) geometry. If selected,
rotation is scaled by 1/sin(i), outflow by 1/cos(i). Radius is not scaled
for rotation, but by 1/cos(i) for outflow. Small position angle based corrections
are also applied. [Default: f] </dd>

<dt><b>mode=r|o</b> </dt>
<dd>Select output mode: rotation (r)
or <a href='outflow.o.html'>outflow (o)</a>
.   For rotation, points around <b>pa=</b> are selected, for outflow,
points around <b>pan=</b>. [Default: r] </dd>

<dt><b>side=0|-1|1</b> </dt>
<dd>By default it will stack both
sides, but this option will allow you to stack one or the other side. [Default:
0] </dd>

<dt><b>tab=t|f</b> </dt>
<dd>(debugging) write a test table.  [Default: f] </dd>

<dt><b>jiggle=t|f</b> </dt>
<dd>Debugging
spreading signal. Don&rsquo;t use. </dd>
</dl>

<h2><a name='sect4' href='#toc4'>Caveats</a></h2>
Code is still under developement, in particular
dealing with units is unresolved. <p>
No geometric correction is made based
on the angle in the disk. This could become a future option. Or see the geom=t|f
being played with <p>
A wedge has the disadvantage the the noise decreases
inversely proportional to the sqrt(radius), but has a <i>matched-filter</i> approach
to a conic outflow. An alternative would be to have an option for <b>angle=</b>
to be replaced with <b>width=</b>. <p>
The gaps in radius and/or velocity produced
with <b>gscale=t</b> can be a nuisance. For stacking many images, for example using
<a href='ccdstack.1.html'><i>ccdstack(1NEMO)</i></a>
, this should disappear, but otherwise some smoothing/interpolation
might be needed. Not implemented. <p>
Outflow is hard-coded as outflow along the
Z axis. What should the off-axis relationship be? Conical? 
<h2><a name='sect5' href='#toc5'>Examples</a></h2>
An example
using our standard NGC 6503 cube given in km/s velocity units. 
<p> <br>
<pre>  rvstack ngc6503.ccd rvma.ccd pa=-60 inc=75 vsys=27 center=164,123 rscale=3600

  rvstack ngc6503.ccd rvmi.ccd pa=30  inc=75 vsys=27 center=164,123 rscale=3600

  rvstack ngc6503_83.ccd rvma_83.ccd pa=-60 inc=75 vsys=27 center=129,128
rscale=3600 
  rvstack ngc6503_83.ccd rvmi_83.ccd pa=30  inc=75 vsys=27 center=129,128
rscale=3600 
</pre>
<p> 
<h2><a name='sect6' href='#toc6'>See Also</a></h2>
<a href='ccdzshift.1.html'>ccdzshift(1NEMO)</a>
, <a href='ccdmath.1.html'>ccdmath(1NEMO)</a>
, <a href='image.5.html'>image(5NEMO)</a>
, <a href='rotcur.5.html'>rotcur(5NEMO)</a>

<p>

<p><a href='https://github.com/jbjolly/LineStacker'>https://github.com/jbjolly/LineStacker</a>
 
<p> 
<h2><a name='sect7' href='#toc7'>Files</a></h2>
src/image/rotcur <p>
<br>
<pre>https://www.cv.nrao.edu/fits/data/samples/cubes/ngc6503.fits  (old 1983 VLA
data)
https://...   (TBD - new data)
</pre>
<p> 
<h2><a name='sect8' href='#toc8'>Author</a></h2>
Peter Teuben 
<p> 
<h2><a name='sect9' href='#toc9'>Update History</a></h2>
<br>
<pre>6-May-2021<tt> </tt>&nbsp;<tt> </tt>&nbsp;V0.4 First working version<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
31-may-2021<tt> </tt>&nbsp;<tt> </tt>&nbsp;V0.7 better geometry correction<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
2-jun-2021<tt> </tt>&nbsp;<tt> </tt>&nbsp;V0.8 siwtch to using far side<tt> </tt>&nbsp;<tt> </tt>&nbsp;PJT
</pre><p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<li><a name='toc3' href='#sect3'>Parameters</a></li>
<li><a name='toc4' href='#sect4'>Caveats</a></li>
<li><a name='toc5' href='#sect5'>Examples</a></li>
<li><a name='toc6' href='#sect6'>See Also</a></li>
<li><a name='toc7' href='#sect7'>Files</a></li>
<li><a name='toc8' href='#sect8'>Author</a></li>
<li><a name='toc9' href='#sect9'>Update History</a></li>
</ul>
</body>
</html>
